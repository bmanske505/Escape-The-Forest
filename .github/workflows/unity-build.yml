name: Unity WebGL Auto Build

on:
  push:
    branches:
      - main # trigger build on pushes to main
  pull_request:
    branches:
      - main

jobs:
  webgl-build:
    runs-on: ubuntu-latest
    steps:
      # Checkout repo
      - name: Checkout
        uses: actions/checkout@v3

      # Setup Unity
      - name: Setup Unity
        uses: game-ci/unity-setup@v2
        with:
          unityVersion: 6000.3.5f1 # your Unity version
          activateLicense: false

      # Build WebGL
      - name: Build WebGL
        uses: game-ci/unity-builder@v2
        with:
          buildTarget: WebGL
          projectPath: "."
          outputPath: "Builds/WebGL"
          versioning: None

      # Deploy to GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }} # auto-generated by GitHub
          publish_dir: ./Builds/WebGL
          publish_branch: gh-pages

      # Upload to Itch.io
      - name: Upload to Itch.io
        uses: crazy-max/ghaction-itchio@v1
        with:
          user: ${{ secrets.ITCH_USERNAME }}
          key: ${{ secrets.ITCH_API_KEY }}
          game: escape-the-forest:html # your Itch.io game slug and channel
          path: ./Builds/WebGL
